/*
    Events Calendar - v0.1.0 - [last build on 2014-04-02]
    https://github.com/pcaldredbann/EventsCalendar
    Copyright (c) 2014 Paul Aldred-Bann
    Licensed MIT
*/
!function(a){"use strict";function b(a){if(a){var b=new Date(a),c=b.getFullYear(),d=b.getMonth(),e=b.getDate();return[e,d,c].join("/")}}function c(a){var c=this;this.initialPeriod=ko.observable(new Date(a.period.year,a.period.month,1,0,0,0,0)),this.initialPeriodMonth=ko.computed(function(){},this),this.startDate=ko.computed(function(){if(this.initialPeriod()){for(var a=new Date(c.initialPeriod());1!==a.getDay();)a.setDate(a.getDate()-1);return a}},this),this.endDate=ko.computed(function(){if(this.startDate()){var a=new Date(this.startDate());return a.setDate(a.getDate()+41),a}},this),this.weeks=ko.computed(function(){if(this.startDate()&&this.endDate()){var a=[],b=new Date(this.startDate());do a.push({date:new Date(b),event:null}),b.setDate(b.getDate()+1);while(b.getTime()<this.endDate().getTime());for(var c=[],e=0;e<a.length;e+=7)c.push(new d({days:a.slice(e,e+7)}));return c}},this),this.prevPeriod=ko.computed(function(){return b(this.startDate())},this),this.nextPeriod=ko.computed(function(){return b(this.endDate())},this),this.getDate=function(a){var b=[];return ko.utils.arrayForEach(c.weeks(),function(a){b=b.concat.apply(b,a.days)}),ko.utils.arrayFirst(b,function(b){return b.date.getTime()===a.getTime()})},this.createEvent=function(a,b){var d=c.getDate(a);if(d.event())throw"There is already an event scheduled on this date.";d.event(b)}}function d(a){this.days=ko.utils.arrayMap(a.days,function(a){return new e(a)})}function e(a){this.date=new Date(a.date),this.event=ko.observable(a.event)}a.fn.EventsCalendar=function(b){return b=a.extend({period:{month:(new Date).getMonth(),year:(new Date).getFullYear()}},b),this.length?this.each(function(){ko.applyBindings(new c(b),this)}):void 0},a.expr[":"].EventsCalendar=function(a){return ko.dataFor(a)}}(jQuery);